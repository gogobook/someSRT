1
00:00:00,240 --> 00:00:03,019
讓我們來看看使用一個非常基本的同步適配器

2
00:00:03,020 --> 00:00:04,840
需要些什麼

3
00:00:04,840 --> 00:00:07,730
我們需要寫兩個服務

4
00:00:07,730 --> 00:00:09,870
每個服務完成一個基本目的

5
00:00:09,870 --> 00:00:15,780
把一個代表安卓活頁夾界面的物體傳送到系統框架中去

6
00:00:15,780 --> 00:00:18,320
活頁夾相當於一種低級膠水

7
00:00:18,320 --> 00:00:21,620
粘合安卓系統裡的交叉處理通信

8
00:00:21,620 --> 00:00:24,030
其實每次你聲控安卓系統服務時

9
00:00:24,030 --> 00:00:26,750
都使用到了安卓活頁夾

10
00:00:26,750 --> 00:00:31,990
目的和內容供應商只是在活頁夾界面之上的高級抽象

11
00:00:31,990 --> 00:00:36,879
有一種稱為AIDL的語言就是用來幫助定義這些界面的

12
00:00:36,880 --> 00:00:38,800
在此我們不能涉及所有內容

13
00:00:38,800 --> 00:00:41,980
但是服務和活頁夾還有很多其他用處

14
00:00:41,980 --> 00:00:43,989
在正式開始前還有一件事

15
00:00:43,990 --> 00:00:47,740
我們需要定義一個認證器服務和一個認證器

16
00:00:47,740 --> 00:00:51,090
這只供安卓賬號體系使用

17
00:00:51,090 --> 00:00:53,030
來允許我們創建賬號

18
00:00:53,030 --> 00:00:55,320
同步適配器需要一個賬號

19
00:00:55,320 --> 00:01:00,090
而賬號體系需要一個由認證器服務傳送的認證器

20
00:01:00,090 --> 00:01:03,430
你會看到我們的認證器只是一連串的樁

21
00:01:03,430 --> 00:01:06,060
加上一些每次調用時會拋出的異常

22
00:01:06,060 --> 00:01:08,290
來證明它不是真的被使用著

23
00:01:08,290 --> 00:01:10,160
最後一件事

24
00:01:10,160 --> 00:01:15,000
這個部分基本按照developer.android.com

25
00:01:15,000 --> 00:01:18,230
關於同步適配器的網上訓練而製作

26
00:01:18,230 --> 00:01:21,640
如果你有更多問題可以去那兒看看

27
00:01:21,640 --> 00:01:24,160
接下來我們要創建一個新的程序包 命名為「同步」

28
00:01:24,160 --> 00:01:26,700
來存儲這些好東西

29
00:01:26,700 --> 00:01:30,370
之後我們要為認證器創建一個新的類文件

30
00:01:30,370 --> 00:01:36,430
這個代碼我們只需要直接從developer.android.com複製過來

31
00:01:36,430 --> 00:01:39,250
就像我之前說的 它只是一個樁

32
00:01:39,250 --> 00:01:43,700
你能看得出來因為我們調用任何功能都拋出異常

33
00:01:43,700 --> 00:01:45,790
除了構造器之外

34
00:01:45,790 --> 00:01:48,583
我們還需要一個文件

35
00:01:48,583 --> 00:01:50,795
創建SunshineAuthenticatorService

36
00:01:50,796 --> 00:01:53,360
這裡會存放更多為我們而寫的代碼

37
00:01:53,360 --> 00:01:58,720
它允許賬戶管理器訪問我們剛剛複製進來的空的認證器

38
00:01:58,720 --> 00:02:02,950
現在我們可以在strings.xml中加入賬號類型

39
00:02:02,950 --> 00:02:06,870
賬號類型字符串表明這是專門在這個程序中使用的

40
00:02:06,880 --> 00:02:10,370
如果用同一個賬號開發了很多程序

41
00:02:10,370 --> 00:02:14,250
最好創建一個example.com賬號

42
00:02:14,250 --> 00:02:16,090
我們還想要做些清理工作

43
00:02:16,090 --> 00:02:18,201
然後加入一個內容權限字符串

44
00:02:18,201 --> 00:02:20,790
注意 這應該與內容供應商的字符串相符

45
00:02:20,790 --> 00:02:25,920
等下我們可以修復XML文件使它們用同一個字符串

46
00:02:25,920 --> 00:02:31,250
接著創建一個新的XML源文件 命名為authenticator.xml

47
00:02:31,250 --> 00:02:34,590
根元素設為 賬戶認證器

48
00:02:34,590 --> 00:02:39,490
你可能已經發現 陽光認證器服務其實需要

49
00:02:39,490 --> 00:02:44,720
在AndroidManifest.xml中用程序包管理器註冊

50
00:02:44,720 --> 00:02:48,290
這裡還有更多好東西來幫你完成這一項

51
00:02:48,290 --> 00:02:49,950
現在可要小心啦

52
00:02:49,950 --> 00:02:52,899
這些字符串都需要完全匹配上

53
00:02:52,900 --> 00:02:56,250
系統提示的錯誤賬號信息

54
00:02:56,250 --> 00:02:58,800
並不一定是直覺性的

55
00:02:58,800 --> 00:03:00,572
當你完全匹配字符串之後

56
00:03:00,572 --> 00:03:02,140
應該就可以創建有效賬號了

57
00:03:02,140 --> 00:03:07,010
再說一次 這些都是為了同步適配器能與一個賬號相連

58
00:03:07,010 --> 00:03:09,018
我們實際不需要使用它

59
00:03:09,019 --> 00:03:12,990
好的 讓我們微調一下清單中的供應商標籤

60
00:03:12,990 --> 00:03:15,390
我們要加入可同步的屬性

61
00:03:15,390 --> 00:03:18,256
這樣安卓就能知道我們打算將內容供應商

62
00:03:18,256 --> 00:03:19,484
與服務器同步

63
00:03:19,484 --> 00:03:23,212
同時 我們把android:exported設為偽代碼

64
00:03:23,212 --> 00:03:25,251
這和默認狀態一致

65
00:03:25,252 --> 00:03:28,000
代表著其他程序能看到我們的內容

66
00:03:28,000 --> 00:03:31,270
最後 把權限改成使用我們新寫的字符串

67
00:03:31,270 --> 00:03:34,020
現在來處理一些其他的許可權

68
00:03:34,020 --> 00:03:37,010
我們需要可以讀寫同步設置

69
00:03:37,010 --> 00:03:38,459
這些都好理解

70
00:03:38,460 --> 00:03:43,470
雖然並不是真的要用 我們還需要認證賬號

71
00:03:43,470 --> 00:03:46,653
用戶不應該需要為這些許可權擔心

72
00:03:46,653 --> 00:03:51,790
但是作為開發者 我們應該在添加新許可權時額外小心

73
00:03:51,790 --> 00:03:55,623
接著我們在」同步」中創建陽光同步適配器文檔

74
00:03:55,623 --> 00:03:59,016
這能擴大抽象線程同步適配器分類

75
00:03:59,016 --> 00:04:01,579
按下Ctrl+I和Ctrl+O

76
00:04:01,580 --> 00:04:05,010
來在構造器中實施必需的抽象方法

77
00:04:05,010 --> 00:04:08,510
我們使用第一構造器 可以等會再來填這個

78
00:04:08,510 --> 00:04:12,060
你可能還記得 同步適配器模式需要另一個服務

79
00:04:12,060 --> 00:04:16,750
所以我們得再創建一個Java類叫做陽光同步服務

80
00:04:16,750 --> 00:04:21,709
這個類用於把同步適配器活頁夾傳送到同步管理器中

81
00:04:21,709 --> 00:04:27,219
活頁夾使用抽象線程同步適配類

82
00:04:27,230 --> 00:04:30,730
然後用getSyncAdapterBinder方式返回

83
00:04:30,730 --> 00:04:33,460
現在我們還需要一個XML文件

84
00:04:33,460 --> 00:04:37,669
創建syncadapter.xml 設置根元素：同步適配器

85
00:04:37,670 --> 00:04:42,490
同樣的 這個XML文件定義了與我們的同步適配器相關的設置

86
00:04:42,490 --> 00:04:44,060
包括它的內容權限

87
00:04:44,060 --> 00:04:46,000
所同步的賬號類型

88
00:04:46,000 --> 00:04:48,230
是否對用戶可見

89
00:04:48,230 --> 00:04:49,930
是否支持上載

90
00:04:49,930 --> 00:04:53,720
--上載會改變內容供應商和同步適配器互動的方式--

91
00:04:53,720 --> 00:04:57,140
是否允許平行同步 以及是否總是可同步的

92
00:04:57,140 --> 00:05:00,252
這些設置是為這個程序量身而定的

93
00:05:00,252 --> 00:05:02,030
而且我覺得你能猜到接下來我們要做什麼

94
00:05:02,030 --> 00:05:06,169
你猜對了 我們需要向程序包管理器註冊同步適配器服務

95
00:05:06,170 --> 00:05:11,850
所以我們需要創建更多清單條目 包括一些重要的自觀照資料

96
00:05:11,850 --> 00:05:15,190
其中最重要的是與我們剛創建的文檔相連的連結

97
00:05:15,190 --> 00:05:17,740
好的 我們快要完成了

98
00:05:17,740 --> 00:05:21,010
接下來我們可以開始做同步適配器

99
00:05:21,010 --> 00:05:24,730
我們可以從幫助功能開始 註冊一個虛擬同步賬號

100
00:05:24,730 --> 00:05:27,480
然後確保它被創建出來了

101
00:05:27,480 --> 00:05:30,490
之後 我們可以在同步適配器中增加另一個幫助功能

102
00:05:30,490 --> 00:05:33,310
使測試我們的同步適配器更加簡單

